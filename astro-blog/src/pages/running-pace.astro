---
import Layout from '../layouts/Layout.astro';
import { calculatePace } from '../lib/pace';

const pageTitle = 'ランニングのペース計算・ペース表｜10km・ハーフ・フル対応';
const metaDescription = 'ランニングのペースを簡単に計算できる無料ツールと、km別・距離別のペース表を掲載。10km、ハーフ、フルマラソンに対応。';

const tenKTargets = ['0:25:00', '0:30:00', '0:35:00', '0:40:00', '0:45:00', '0:50:00', '0:55:00', '1:00:00'];
const halfTargets = ['0:55:00', '1:00:00', '1:05:00', '1:10:00', '1:15:00', '1:20:00', '1:25:00', '1:30:00', '1:35:00', '1:40:00', '1:50:00', '2:00:00', '2:10:00'];
const fullTargets = ['2:00:00', '2:10:00', '2:20:00', '2:30:00', '2:40:00', '2:50:00', '3:00:00', '3:10:00', '3:20:00', '3:30:00', '4:00:00', '4:30:00', '5:00:00', '5:30:00', '6:00:00'];

function timeToSeconds(value: string) {
  const parts = value.split(':').map((p) => Number(p));
  if (parts.length !== 3 || parts.some((p) => !Number.isFinite(p))) return 0;
  return parts[0] * 3600 + parts[1] * 60 + parts[2];
}

function formatTime(seconds: number) {
  if (!Number.isFinite(seconds)) return '';
  const s = Math.round(seconds);
  const h = Math.floor(s / 3600);
  const m = Math.floor((s % 3600) / 60);
  const sec = s % 60;
  if (h > 0) return `${h}:${String(m).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
  return `${m}:${String(sec).padStart(2, '0')}`;
}

function buildRows(distanceKm: number, targets: string[], splitPointsKm: number[]) {
  return targets.map((t) => {
    const totalSeconds = timeToSeconds(t);
    const pace = calculatePace(distanceKm, totalSeconds);
    return {
      target: formatTime(totalSeconds),
      pace: formatTime(pace.pacePerKm),
      splits: splitPointsKm.map((km) => formatTime(pace.pacePerKm * km)),
    };
  });
}

const tenKRows = buildRows(10, tenKTargets, [3, 5, 10]);
const halfRows = buildRows(21.0975, halfTargets, [5, 10, 15, 20, 21.0975]);
const fullRows = buildRows(42.195, fullTargets, [5, 10, 15, 20, 21.0975, 25, 30, 35, 40, 42.195]);

// Intentionally inline paragraphs for clarity and emphasis in the UI.
---

<Layout
  pageTitle={pageTitle}
  metaDescription={metaDescription}
  noSidebar={true}
  pageHeading="ランニングのペース計算・ペース表"
  pageLead="距離と目標タイムから、1kmペースと主要ラップを計算します。入力内容は自動で反映されます。"
>

  <section id="calculator" class="card p-5 md:p-6 mb-8 scroll-mt-20">
    <h2 class="text-lg font-semibold mb-4">ペースを計算する</h2>
    <form id="paceForm" class="grid gap-4 md:grid-cols-[1fr_1fr]">
      <div>
        <label for="distanceSelect" class="block text-sm font-medium mb-1">距離</label>
        <select id="distanceSelect" class="w-full border rounded px-3 py-2 bg-white dark:bg-gray-900">
          <option value="0.4">400メートル</option>
          <option value="3">3km</option>
          <option value="5">5km</option>
          <option value="10">10km</option>
          <option value="21.0975">ハーフ</option>
          <option value="42.195" selected>フル</option>
          <option value="custom">カスタム</option>
        </select>
        <div id="customDistanceWrap" class="mt-2 hidden">
          <label for="customDistance" class="block text-sm font-medium mb-1">カスタム距離（km）</label>
          <input id="customDistance" type="number" inputmode="decimal" step="0.01" min="0.1" class="w-full border rounded px-3 py-2" placeholder="例：7.5" />
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">目標タイム（時:分:秒）</label>
        <div class="flex items-center gap-2">
          <input id="timeHours" type="number" inputmode="numeric" min="0" class="w-20 border rounded px-2 py-2" value="3" />
          <span>:</span>
          <input id="timeMinutes" type="number" inputmode="numeric" min="0" max="59" class="w-20 border rounded px-2 py-2" value="30" />
          <span>:</span>
          <input id="timeSeconds" type="number" inputmode="numeric" min="0" max="59" class="w-20 border rounded px-2 py-2" value="0" />
        </div>
      </div>
    </form>
    <div id="paceError" class="mt-3 text-sm text-red-600 hidden"></div>
    <div class="mt-4 grid gap-3 md:grid-cols-2">
      <div class="border rounded px-4 py-3">
        <div class="text-sm text-gray-500">1kmペース</div>
        <div id="pacePerKm" class="text-lg font-semibold">-</div>
      </div>
      <div class="border rounded px-4 py-3">
        <div class="text-sm text-gray-500">400メートルペース</div>
        <div id="pacePer400" class="text-lg font-semibold">-</div>
      </div>
      <div class="border rounded px-4 py-3">
        <div class="text-sm text-gray-500">3km通過</div>
        <div id="split3k" class="text-lg font-semibold">-</div>
      </div>
      <div class="border rounded px-4 py-3">
        <div class="text-sm text-gray-500">5km通過</div>
        <div id="split5k" class="text-lg font-semibold">-</div>
      </div>
      <div class="border rounded px-4 py-3">
        <div class="text-sm text-gray-500">10km通過</div>
        <div id="split10k" class="text-lg font-semibold">-</div>
      </div>
      <div class="border rounded px-4 py-3">
        <div class="text-sm text-gray-500">ハーフ通過</div>
        <div id="splitHalf" class="text-lg font-semibold">-</div>
      </div>
    </div>
    <details class="mt-6">
      <summary class="cursor-pointer text-sm text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100">
        ペースの考え方について（補足）
      </summary>
      <div class="mt-3 space-y-3">
        <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">
          ランニングにおけるペースは、練習やレースの出来を直接決めるものというより、
          <span class="font-semibold">練習では設定タイムの目安</span>になり、
          <span class="font-semibold">レースでは目標タイムに向けたベースライン</span>となるものです。
          目標タイムがある場合、「そのタイムを達成するには、1kmあたりどれくらいのペースで走る必要があるのか」を事前に把握しておくことで、練習内容やレース当日の判断がしやすくなります。
        </p>

        <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">
          このページでは、距離と目標タイムを入力することで、
          <span class="font-semibold">1kmあたりのペース、400メートルあたりのペース、3km・5km・10km・ハーフの通過タイム</span>を数値として確認できます。
        </p>

        <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">
          レース本番では、アドレナリンの影響で<span class="font-semibold">序盤に想定より速く入ってしまう</span>ことがよくあります。
          一方で、過去の失敗経験や「突っ込みすぎたくない」という意識から、
          <span class="font-semibold">必要以上に慎重になってペースを抑えすぎてしまう</span>こともあります。
          どちらも、結果的に目標としていたタイムに届かなくなる原因になり得ます。
        </p>

        <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">
          レースに向けては、
          <span class="font-semibold">序盤の各距離（1km、3km、5kmなど）での目標ペースや通過タイムを事前に頭に入れておき</span>、
          当日は <span class="font-semibold">GPS 時計や距離表示を使って客観的に確認しながら走る</span>のが現実的です。
          よほど距離に自信がある場合を除いて、
          <span class="font-semibold">少なくともレース距離の半分くらいまでは目標ペースを守る</span>意識で進めると、後半に大きく崩れにくくなります。
        </p>

        <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">
          練習では、<span class="font-semibold">レースで想定しているペースで走れる能力を獲得すること</span>が重要になります。
          理想を言えば、想定ペースのままレース距離を走れればそれ自体が目標達成ですが、現実的には難しいため、レースを想定しながらバリエーションをつけて練習していくのが良いでしょう。
          例えば、レースペースで一定距離を繰り返す<span class="font-semibold">レペティション</span>、ペースに強弱をつける<span class="font-semibold">変化走</span>、一定の負荷を繰り返す<span class="font-semibold">インターバル</span>、少しペースを落として距離を踏む距離走などを組み合わせることで、無理なくレースに近い負荷を作ることができます。
        </p>

        <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">
          また、どんな練習よりも大切なのは<span class="font-semibold">継続できること</span>です。
          疲労が強い状態で無理に高強度の練習を行ったり、違和感を抱えたまま走り続けたりすると、結果的に長い期間走れなくなることもあります。
          情熱と冷静さのバランスを取りながら、走り続けられる状態を保つことが、長期的には一番の近道だと思います。
        </p>

        <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">
          このページで計算できるペースや通過タイムは、
          <span class="font-semibold">その通りに走るための正解ではなく、判断するための材料</span>です。
          練習やレースの状況に応じて参考にしながら、自分なりの判断を重ねていくためのベースラインとして使ってもらえればと思います。
        </p>
      </div>
    </details>
  </section>

  <section id="table" class="scroll-mt-20">
    <h2 class="text-lg font-semibold mb-4">ペース表を見る</h2>
    <div class="grid gap-6">
      <section class="card p-5 md:p-6">
        <h3 class="text-lg font-semibold mb-4">10km 目標ラップ表</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm border-collapse min-w-[520px]">
            <thead>
              <tr class="text-left border-b">
                <th class="py-2">目標</th>
                <th class="py-2">1km</th>
                <th class="py-2">3km</th>
                <th class="py-2">5km</th>
                <th class="py-2">10km</th>
              </tr>
            </thead>
            <tbody>
              {tenKRows.map((row) => (
                <tr class="border-b">
                  <td class="py-2">{row.target}</td>
                  <td class="py-2">{row.pace}</td>
                  <td class="py-2">{row.splits[0]}</td>
                  <td class="py-2">{row.splits[1]}</td>
                  <td class="py-2">{row.splits[2]}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </section>

      <section class="card p-5 md:p-6">
        <h3 class="text-lg font-semibold mb-4">ハーフマラソン 目標ラップ表</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm border-collapse min-w-[720px]">
            <thead>
              <tr class="text-left border-b">
                <th class="py-2">目標</th>
                <th class="py-2">1km</th>
                <th class="py-2">5km</th>
                <th class="py-2">10km</th>
                <th class="py-2">15km</th>
                <th class="py-2">20km</th>
                <th class="py-2">ハーフ</th>
              </tr>
            </thead>
            <tbody>
              {halfRows.map((row) => (
                <tr class="border-b">
                  <td class="py-2">{row.target}</td>
                  <td class="py-2">{row.pace}</td>
                  <td class="py-2">{row.splits[0]}</td>
                  <td class="py-2">{row.splits[1]}</td>
                  <td class="py-2">{row.splits[2]}</td>
                  <td class="py-2">{row.splits[3]}</td>
                  <td class="py-2">{row.splits[4]}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </section>

      <section class="card p-5 md:p-6">
        <h3 class="text-lg font-semibold mb-4">フルマラソン 目標ラップ表</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm border-collapse min-w-[860px]">
            <thead>
              <tr class="text-left border-b">
                <th class="py-2">目標</th>
                <th class="py-2">1km</th>
                <th class="py-2">5km</th>
                <th class="py-2">10km</th>
                <th class="py-2">15km</th>
                <th class="py-2">20km</th>
                <th class="py-2">ハーフ</th>
                <th class="py-2">25km</th>
                <th class="py-2">30km</th>
                <th class="py-2">35km</th>
                <th class="py-2">40km</th>
                <th class="py-2">ゴール</th>
              </tr>
            </thead>
            <tbody>
              {fullRows.map((row) => (
                <tr class="border-b">
                  <td class="py-2">{row.target}</td>
                  <td class="py-2">{row.pace}</td>
                  <td class="py-2">{row.splits[0]}</td>
                  <td class="py-2">{row.splits[1]}</td>
                  <td class="py-2">{row.splits[2]}</td>
                  <td class="py-2">{row.splits[3]}</td>
                  <td class="py-2">{row.splits[4]}</td>
                  <td class="py-2">{row.splits[5]}</td>
                  <td class="py-2">{row.splits[6]}</td>
                  <td class="py-2">{row.splits[7]}</td>
                  <td class="py-2">{row.splits[8]}</td>
                  <td class="py-2">{row.splits[9]}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </section>

  <script type="module" set:html={`
    const calculatePace = ${calculatePace.toString()};

    function parseNumber(value) {
      const num = Number(value);
      return Number.isFinite(num) ? num : NaN;
    }

    function formatTime(seconds) {
      if (!Number.isFinite(seconds)) return '';
      const s = Math.round(seconds);
      const h = Math.floor(s / 3600);
      const m = Math.floor((s % 3600) / 60);
      const sec = s % 60;
      if (h > 0) return \`\${h}:\${String(m).padStart(2, '0')}:\${String(sec).padStart(2, '0')}\`;
      return \`\${m}:\${String(sec).padStart(2, '0')}\`;
    }

    function buildQuery(distanceValue, customKm, h, m, s) {
      const params = new URLSearchParams();
      params.set('dist', distanceValue);
      if (distanceValue === 'custom' && Number.isFinite(customKm)) {
        params.set('km', String(customKm));
      }
      const hh = String(h).padStart(2, '0');
      const mm = String(m).padStart(2, '0');
      const ss = String(s).padStart(2, '0');
      params.set('t', \`\${hh}:\${mm}:\${ss}\`);
      return params.toString();
    }

    function readQuery() {
      const params = new URLSearchParams(window.location.search);
      const dist = params.get('dist');
      const km = params.get('km');
      const t = params.get('t');
      return { dist, km, t };
    }

    function applyQuery(inputs) {
      const { dist, km, t } = readQuery();
      if (dist) inputs.distanceSelect.value = dist;
      if (dist === 'custom') inputs.customWrap.classList.remove('hidden');
      if (km) inputs.customDistance.value = km;
      if (t && /\\d{1,2}:\\d{2}:\\d{2}/.test(t)) {
        const [hh, mm, ss] = t.split(':').map((v) => Number(v));
        if (Number.isFinite(hh)) inputs.timeHours.value = String(hh);
        if (Number.isFinite(mm)) inputs.timeMinutes.value = String(mm);
        if (Number.isFinite(ss)) inputs.timeSeconds.value = String(ss);
      }
    }

    function showError(el, message) {
      el.textContent = message;
      el.classList.remove('hidden');
    }

    function clearError(el) {
      el.textContent = '';
      el.classList.add('hidden');
    }

    function update() {
      const distanceValue = distanceSelect.value;
      const h = parseNumber(timeHours.value);
      const m = parseNumber(timeMinutes.value);
      const s = parseNumber(timeSeconds.value);
      const customKm = parseNumber(customDistance.value);

      clearError(errorEl);

      let distanceKm = NaN;
      if (distanceValue === 'custom') {
        distanceKm = customKm;
      } else {
        distanceKm = parseNumber(distanceValue);
      }

      if (!Number.isFinite(distanceKm) || distanceKm <= 0) {
        showError(errorEl, '距離を正しく入力してください。');
        return;
      }

      if (!Number.isFinite(h) || h < 0 || !Number.isFinite(m) || m < 0 || m > 59 || !Number.isFinite(s) || s < 0 || s > 59) {
        showError(errorEl, '目標タイムは時:分:秒で入力してください。');
        return;
      }

      const totalSeconds = h * 3600 + m * 60 + s;
      if (totalSeconds <= 0) {
        showError(errorEl, '目標タイムが0秒になっています。');
        return;
      }

      const result = calculatePace(distanceKm, totalSeconds);
      pacePerKm.textContent = \`\${formatTime(result.pacePerKm)}／km\`;
      pacePer400.textContent = formatTime(result.split400m);
      split3k.textContent = distanceKm >= 3 ? formatTime(result.pacePerKm * 3) : '対象外';
      split5k.textContent = distanceKm >= 5 ? formatTime(result.split5k) : '対象外';
      split10k.textContent = distanceKm >= 10 ? formatTime(result.split10k) : '対象外';
      splitHalf.textContent = distanceKm >= 21.0975 ? formatTime(result.splitHalf) : '対象外';

      const query = buildQuery(distanceValue, customKm, h, m, s);
      const url = new URL(window.location.href);
      url.search = query ? \`?\${query}\` : '';
      window.history.replaceState({}, '', url.toString());
    }

    const distanceSelect = document.getElementById('distanceSelect');
    const customDistance = document.getElementById('customDistance');
    const customWrap = document.getElementById('customDistanceWrap');
    const timeHours = document.getElementById('timeHours');
    const timeMinutes = document.getElementById('timeMinutes');
    const timeSeconds = document.getElementById('timeSeconds');
    const errorEl = document.getElementById('paceError');
    const pacePerKm = document.getElementById('pacePerKm');
    const pacePer400 = document.getElementById('pacePer400');
    const split3k = document.getElementById('split3k');
    const split5k = document.getElementById('split5k');
    const split10k = document.getElementById('split10k');
    const splitHalf = document.getElementById('splitHalf');

    const inputs = { distanceSelect, customDistance, customWrap, timeHours, timeMinutes, timeSeconds };
    applyQuery(inputs);

    distanceSelect.addEventListener('change', () => {
      if (distanceSelect.value === 'custom') {
        customWrap.classList.remove('hidden');
      } else {
        customWrap.classList.add('hidden');
      }
      update();
    });
    customDistance.addEventListener('input', update);
    timeHours.addEventListener('input', update);
    timeMinutes.addEventListener('input', update);
    timeSeconds.addEventListener('input', update);

    update();
  `}></script>
</Layout>
